# cloudbuild.yaml

steps:
  # Build the Docker image
  - name: "gcr.io/cloud-builders/docker"
    args:
      [
        "build",
        "--build-arg",
        "VITE_API_URL=https://test-django-backend-igbahdisaq-uc.a.run.app/api",
        "-t",
        "gcr.io/test-gyosu-ai/my-react-app",
        ".",
      ]

  # Push the Docker image to Google Container Registry
  - name: "gcr.io/cloud-builders/docker"
    args: ["push", "gcr.io/test-gyosu-ai/my-react-app"]

# Optionally, you can deploy the image to Cloud Run (if you want to automate this step)
# - name: 'gcr.io/cloud-builders/gcloud'
#   args: ['run', 'deploy', 'your-service-name', '--image', 'gcr.io/test-gyosu-ai/my-react-app', '--region', 'your-region', '--platform', 'managed']

# Define variables
substitutions:
  _VITE_API_URL: "https://test-django-backend-igbahdisaq-uc.a.run.app/api"
